<th:block th:fragment="AnswerFragment (inquiry, isEditMode, answerApiUrl)">
    <div class="card answer-form-card mt-4" id="answerFormContainer">
        <div class="card-header">
            <h5 class="mb-0 card-title-text" th:text="${isEditMode ? '답변 수정' : '답변 작성'}"></h5>
        </div>
        <div class="card-body">

            <form th:id="${isEditMode ? 'editAnswerForm' : 'newAnswerForm'}">
                <input type="hidden" name="inqryId" th:value="${inquiry.inqryId}" />
                <input type="hidden" name="ansId" th:value="${isEditMode ? inquiry.answer.ansId : ''}" />

                <div class="form-group">
                    <label for="answerContentInput" class="form-label">답변 내용</label>
                    <textarea class="form-control" id="answerContentInput" name="ansCn" rows="6" required
                        th:placeholder="${isEditMode ? '' : '답변을 입력해주세요.'}"
                        th:text="${isEditMode ? inquiry.answer.ansCn : ''}"></textarea>
                </div>

                <div id="ans-button" class="form-group d-flex justify-content-end mt-3 gap-2">
                    <button type="button" id="submitAnswerBtn" class="btn btn-custom-positive"
                            style="width: 90px; height:42px;">[[${isEditMode} ? '수정 완료' : '답변 제출']]</button>
                    <button type="button" th:if="${isEditMode}" id="cancelEditBtn" class="btn btn-custom-neutral"
                            style="width: 90px; height: 42px;">취소</button>
                </div>
            </form>

        </div>
    </div>

    <!-- 공통 스크립트 -->
    <script th:inline="javascript">
    document.addEventListener('DOMContentLoaded', function() {
        const submitBtn = document.getElementById('submitAnswerBtn');
        const form = submitBtn?.closest('form');

        if (submitBtn && form) {
            submitBtn.addEventListener('click', function() {
                const inqryId = form.inqryId.value;
                const ansId = form.ansId.value;
                const ansCn = form.ansCn.value;

                if (!ansCn.trim()) {
                    Swal.fire({
                        icon: 'warning',
                        title: '입력 필요',
                        text: '답변 내용을 입력해주세요.',
                    });
                    return;
                }

                const answerApiUrl = /*[[${answerApiUrl}]]*/ '/default/api/url';

                const payload = {
                    inqryId: inqryId,
                    ansCn: ansCn,
                    ansId: ansId
                };

                fetch(answerApiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload)
                })
                .then(response => {
                    const contentType = response.headers.get("content-type");
                    if (response.ok && contentType?.includes("application/json")) {
                        return response.json();
                    }
                    return response.text().then(text => { throw new Error(text || '서버 오류 발생'); });
                })
                .then(data => {
                    if (data.status === 'success') {
                        Swal.fire({ icon: 'success', title: '성공', text: data.message })
                            .then(() => window.location.reload());
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: '실패',
                            text: '답변 처리 실패: ' + (data.message || '알 수 없는 오류'),
                        });
                    }
                })
                .catch(error => {
                    console.error('AJAX 요청 또는 응답 처리 오류:', error);
                    Swal.fire({
                        icon: 'error',
                        title: '오류 발생',
                        text: '답변 처리 중 오류가 발생했습니다. 자세한 내용은 콘솔을 확인해주세요.',
                    });
                });
            });
        }
    });
    </script>
</th:block>
