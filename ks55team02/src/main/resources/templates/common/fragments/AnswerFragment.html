<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>
<th:block th:fragment="AnswerFragment (inquiryData, isEditMode, answerApiUrl)">
    <div class="card answer-form-card mt-4" id="answerFormContainer">
        <div class="card-header">
            <h5 class="mb-0 card-title-text" th:text="${isEditMode ? '답변 수정' : '답변 작성'}"></h5>
        </div>
        <div class="card-body">
            <form id="answerHandlingForm">
                <!-- 중요: 기능 유지를 위해 hidden input들은 그대로 유지 -->
                <input type="hidden" name="inqryId" th:value="${inquiryData.inqryId}" />
                <input type="hidden" name="ansId" th:value="${isEditMode ? inquiryData.answer.ansId : ''}" />

                <div class="form-group">
                    <label for="answerContentInput" class="form-label">답변 내용</label>
                    <textarea class="form-control" id="answerContentInput" name="ansCn" rows="6" required
                              th:text="${isEditMode ? inquiryData.answer.ansCn : ''}"
                              placeholder="답변을 입력해주세요."></textarea>
                </div>
                <div id="ans-button" class="form-group d-flex justify-content-end mt-3 gap-2">
    <button type="button" id="submitAnswerBtn" class="btn btn-custom-positive"
            th:text="${isEditMode ? '수정 완료' : '답변 제출'}"
             style="width: 90px !important; height:42px; line-height: 1.5;"></button>
    
    <button type="button" id="cancelEditBtn" class="btn btn-custom-neutral d-flex justify-content-center align-items-center" th:if="${isEditMode}" 
        style="width: 90px !important; height: 42px;">
    취소
</button>
</div>
            </form>
        </div>
    </div>
   <script th:inline="javascript">
/* <![CDATA[ */
document.addEventListener('DOMContentLoaded', function() {
    const submitAnswerBtn = document.getElementById('submitAnswerBtn');
    if (submitAnswerBtn) {
        submitAnswerBtn.addEventListener('click', function() {
            const form = document.getElementById('answerHandlingForm');
            const inqryId = form.inqryId.value;
            const ansId = form.ansId.value;
            const ansCn = form.ansCn.value;

            if (!ansCn.trim()) {
                Swal.fire({
                    icon: 'warning',
                    title: '입력 필요',
                    text: '답변 내용을 입력해주세요.',
                });
                return;
            }

            const answerApiUrl = /*[[${answerApiUrl}]]*/ '/default/api/url';

            const payload = {
                inqryId: inqryId,
                ansCn: ansCn,
                ansId: ansId
            };

            fetch(answerApiUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(payload)
            })
            .then(response => {
                const contentType = response.headers.get("content-type");
                if (response.ok && contentType && contentType.indexOf("application/json") !== -1) {
                    return response.json();
                }
                return response.text().then(text => {
                    throw new Error(text || '서버 오류 발생');
                });
            })
            .then(data => {
                if (data.status === 'success') {
                    Swal.fire({
                        icon: 'success',
                        title: '성공',
                        text: data.message,
                    }).then(() => {
                        window.location.reload();
                    });
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: '실패',
                        text: '답변 처리 실패: ' + (data.message || '알 수 없는 오류'),
                    });
                }
            })
            .catch(error => {
                console.error('AJAX 요청 또는 응답 처리 오류:', error);
                Swal.fire({
                    icon: 'error',
                    title: '오류 발생',
                    text: '답변 처리 중 오류가 발생했습니다. 자세한 내용은 콘솔을 확인해주세요.',
                });
            });
        });
    }
});

/* ]]> */
</script>

</th:block>
</body>
</html>