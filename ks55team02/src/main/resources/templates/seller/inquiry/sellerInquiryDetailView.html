<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{seller/layout/layout_Main}">

<head>
    <meta name="appDetail" content="appDetail" />
    <th:block layout:fragment="customCss">
        <link rel="stylesheet" th:href="@{/maincss/assets/customsellercss/sellerInquiryDetailView.css}">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    </th:block>
</head>

<th:block layout:fragment="jsFile"></th:block>

<th:block layout:fragment="contents">
    <div class="content-header">
        <div>
            <h2 class="content-title card-title">스토어 문의 상세</h2>
        </div>
    </div>
    <div class="card">
        <div class="card-body">
            <div class="container">
                <!-- 1. 문의 상세 정보 프래그먼트 -->
                <div th:replace="~{common/fragments/inquiryDetailFragment :: inquiryDetailFragment(inquiryData=${inquiryDetail})}"></div>

                <!-- 2. 페이지 액션 버튼 그룹 (수정, 목록) -->
                <div class="page-actions d-flex justify-content-end align-items-center gap-2 mt-3">
                    <button type="button" id="startEditBtn" class="btn btn-custom-neutral" th:if="${inquiryDetail.answer != null}">답변 수정</button>
                    <a th:href="@{/seller/inquiry/sellerInquiryList}" class="btn btn-custom-neutral">목록으로</a>
                </div>


                <!-- 3. 답변 작성 / 수정 프래그먼트 호출 -->
                <th:block th:if="${inquiryDetail.answer == null}">
                    <!-- ★★★ answerApiUrl을 모델 변수로 전달하도록 수정 ★★★ -->
                    <div th:replace="~{common/fragments/AnswerFragment :: AnswerFragment(inquiryData=${inquiryDetail}, isEditMode=false, answerApiUrl=${answerApiUrl})}"></div>
                </th:block>
                <th:block th:unless="${inquiryDetail.answer == null}">
                    <div id="answerFormWrapper" style="display: none;">
                        <!-- ★★★ 여기도 동일하게 수정 ★★★ -->
                        <div th:replace="~{common/fragments/AnswerFragment :: AnswerFragment(inquiryData=${inquiryDetail}, isEditMode=true, answerApiUrl=${answerApiUrl})}"></div>
                    </div>
                </th:block>
            </div>
        </div>
    </div>
</th:block>

<th:block layout:fragment="jsScript">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.js"></script>
    <!-- 4. 관리자 페이지와 동일한 스크립트 추가 -->
    <script th:inline="javascript">
    document.addEventListener('DOMContentLoaded', function() {
        const startEditBtn = document.getElementById('startEditBtn');
        const answerFormWrapper = document.getElementById('answerFormWrapper');
        const cancelEditBtn = document.querySelector('#answerFormWrapper #cancelEditBtn');

        if (startEditBtn && answerFormWrapper) {
            startEditBtn.addEventListener('click', function() {
                answerFormWrapper.style.display = 'block';
                startEditBtn.style.display = 'none';
            });
        }

        if (cancelEditBtn && answerFormWrapper && startEditBtn) {
            cancelEditBtn.addEventListener('click', function() {
                answerFormWrapper.style.display = 'none';
                startEditBtn.style.display = 'inline-block';
            });
        }
    });
    </script>
</th:block>

</html>