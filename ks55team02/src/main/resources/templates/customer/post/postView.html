<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{customer/layout/layoutMain}">

<head>
    <meta name="description" content="한국스마트정보교육원 ksmybatis" />
    <!-- postDetailView.css 파일을 로드해야 합니다. -->
    <link rel="stylesheet" th:href="@{/maincss/assets/customcustomercss/postView.css}">
    <title>게시글 상세</title>
</head>

<!-- 추가할 js file -->
<th:block layout:fragment="jsFile">
    <!-- 댓글 관련 JavaScript 파일이 있다면 여기에 추가 -->
</th:block>

<!-- 추가할 script -->
<th:block layout:fragment="jsScript">
	<script>
		// 게시글 삭제
		$(() => {
		    $('#del_btn').on('click', e => {
		        e.preventDefault();
		        
		        if(!confirm('정말로 이 게시글을 삭제하시겠습니까?')) {
		            return;
		        }
		
		        const deleteUrl = $(e.currentTarget).data('delete-url');
		
		        $.ajax({
		            url: deleteUrl,
		            type: 'DELETE'
		        }).done(result => {
		            alert('게시글이 삭제되었습니다.');
		            location.href = '/customer/post/postList';
		        }).fail(error => {
		            console.error("삭제 실패: ", error);
		            alert('삭제에 실패했습니다.');
		        });
		    });
		});
	</script>
</th:block>

<th:block layout:fragment="contents">

    <!-- 게시글 상세 정보 영역 -->
    <div class="post-detail-area">
        <!-- 게시글 제목, 작성자, 날짜 등 헤더 정보 -->
        <div class="post-detail-header">
            <!-- 게시글 제목 -->
            <h2 th:text="${postDetail.pstTtl}">게시글 제목</h2>

            <!-- 게시글 정보 (작성자, 날짜, 조회수 등) -->
            <div class="post-detail-info">
                <span th:if="${postDetail.wrtrUserNo != null}" th:text="|작성자: ${postDetail.wrtrUserNo}|">작성자번호</span>
                <span th:text="${postDetail.crtDt}">작성일</span>
                <span>조회수: <span th:text="${postDetail.inqCnt}">0</span></span>
            </div>
        </div>

        <!-- 게시글 본문 내용 -->
        <div class="post-content">
            <p th:utext="${postDetail.pstCn}">게시글 내용</p>
        </div>

        <!-- 게시글 관련 액션 버튼 (수정, 삭제, 목록) -->
        <div class="post-actions">
            <a th:href="@{/customer/post/postList(bbsClsfCd=${bbsClsfCd}, page=${currentPage}, size=${size})}" class="btn btn-secondary">목록</a>
            <!-- 수정, 삭제 버튼은 작성자 본인만 보이도록 권한 체크 필요 -->
            <!-- 예시: th:if="${session.loginUser.userId == postDetail.wrtrUserNo}" -->
            <a th:href="@{/customer/post/postEdit/{pstSn}(pstSn=${postDetail.pstSn})}"
  				 class="btn btn-primary">수정</a>
            <button type="button" id="del_btn" class="btn btn-danger"
       				 th:data-delete-url="@{/customer/post/postDelete/{pstSn}(pstSn=${postDetail.pstSn})}">삭제</button>
        </div>
    </div>

    <!-- 댓글 영역 -->
    <div class="comments-section">
        <h3>댓글</h3>

        <!-- 댓글 작성 폼 -->
        <form id="commentForm" method="post" class="comment-form">
            <!-- 사용자 정보 (로그인 사용자 ID 등)를 숨김 필드로 전달할 수 있습니다. -->
            <!-- <input type="hidden" name="pstSn" th:value="${postDetail.pstSn}"> -->
            <!-- <input type="hidden" name="userId" th:value="${session.loginUser.userId}"> -->
            <textarea id="commentContent" name="commentContent" rows="3" placeholder="댓글을 입력해주세요." required></textarea>
            <button type="submit" class="btn btn-primary">등록</button>
        </form>

        <!-- 댓글 목록 -->
        <div class="comment-list">
            <th:block th:if="${!#lists.isEmpty(commentList)}">
                <div class="comment-item" th:each="comment : ${commentList}">
                    <div class="comment-header">
                        <span class="comment-author" th:text="${comment.commentWriter}">작성자</span>
                        <span class="comment-date" th:text="${comment.crtDt}">작성일</span>
                    </div>
                    <div class="comment-body">
                        <p th:text="${comment.commentCn}">댓글 내용</p>
                    </div>
                    <!-- 댓글 삭제 버튼 (작성자 본인만 보이도록 권한 체크 필요) -->
                    <div class="comment-actions">
                        <!-- 예시: <button type="button" class="btn btn-sm btn-outline-danger delete-comment-btn"
                                     th:data-comment-sn="${comment.commentSn}"
                                     th:if="${session.loginUser.userId == comment.commentWriter}">삭제</button> -->
                        <!-- 임시로 모든 사용자에게 삭제 버튼을 보이게 함 -->
                        <button type="button" class="btn btn-sm btn-outline-danger delete-comment-btn"
                                th:data-comment-sn="${comment.commentSn}">삭제</button>
                    </div>
                </div>
            </th:block>
            <p th:unless="${!#lists.isEmpty(commentList)}">아직 작성된 댓글이 없습니다.</p>
        </div>
    </div>

</th:block>
</html>