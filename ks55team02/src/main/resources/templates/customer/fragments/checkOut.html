<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org/"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{customer/layout/layoutMain}">  

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>결제 확인</title>
    <meta name="keywords" content="HTML5 Template">
    <meta name="description" content="Molla - Bootstrap eCommerce Template">
    <meta name="author" content="p-themes">
    
    <!-- Toss Payments SDK (head 최상단에 위치) -->
    <script src="https://js.tosspayments.com/v1"></script>
    
    <style>
	@font-face {
	  font-family: 'Molla';
	  src: url('../fonts/molla0ab2.woff2') format('woff2');
	}
    </style>

    
	<link rel="apple-touch-icon" sizes="180x180" href="maincss/assets/images/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="maincss/assets/images/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="maincss/assets/images/icons/favicon-16x16.png">
    <link rel="manifest" href="maincss/assets/images/icons/site.html">
    <link rel="mask-icon" href="maincss/assets/images/icons/safari-pinned-tab.svg" color="#666666">
    <link rel="shortcut icon" href="maincss/assets/images/icons/favicon.ico">
    <meta name="apple-mobile-web-app-title" content="Molla">
    <meta name="application-name" content="Molla">
    <meta name="msapplication-TileColor" content="#cc9966">
    <meta name="msapplication-config" content="maincss/assets/images/icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    
    <link rel="stylesheet" href="maincss/assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="maincss/assets/css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">

    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
	<script>
		document.addEventListener('DOMContentLoaded', function () {
		    // 필요한 HTML 요소들을 가져옵니다.
		    const registerAddressBtn = document.getElementById('register-address-btn');
		    const addressDisplay = document.getElementById('address-display');
		
		    // '배송지 등록' 버튼에 클릭 이벤트를 추가합니다.
		    registerAddressBtn.addEventListener('click', function () {
		        // 버튼을 클릭하면 카카오 주소 API를 실행합니다.
		        new daum.Postcode({
		            oncomplete: function(data) {
		                // 사용자가 주소를 선택하면 실행되는 함수입니다.
		                let fullAddress = data.address; // 최종 주소 변수
		                let extraAddress = ''; // 참고 항목 변수
		
		                if (data.addressType === 'R') {
		                    if (data.bname !== '') {
		                        extraAddress += data.bname;
		                    }
		                    if (data.buildingName !== '') {
		                        extraAddress += (extraAddress !== '' ? ', ' + data.buildingName : data.buildingName);
		                    }
		                    fullAddress += (extraAddress !== '' ? ' (' + extraAddress + ')' : '');
		                }
		
		                addressDisplay.innerHTML = '';
		                addressDisplay.classList.remove('address-content-placeholder');
		                addressDisplay.classList.add('address-info');
		
		                // 주소 정보 표시 + 배송 요청사항 추가
		                addressDisplay.innerHTML = `
		                    <div class="address-line">
		                        <span class="address-label">우편번호</span>
		                        <span class="postcode">${data.zonecode}</span>
		                    </div>
		                    <div class="address-line">
		                        <span class="address-label">주소</span>
		                        <span>${fullAddress}</span>
		                    </div>
		                    <div id="detail-address-display" class="address-line" style="display:none;">
		                        <span class="address-label">상세주소</span>
		                        <span id="detail-address-text"></span>
		                    </div>
		                    <div class="address-input-container">
		                        <input type="text" id="detail-address-input" class="form-control" placeholder="상세주소를 입력해주세요">
		                        <button id="confirm-detail-btn" class="btn btn-primary">저장</button>
		                    </div>
		                    <div class="delivery-request-section" style="margin-top:15px;">
		                        <div class="address-line" style="align-items:center;">
		                            <span class="address-label" style="white-space:nowrap;">배송 요청사항</span>
		                            <select id="delivery-request-select" class="form-control" style="flex:1; margin:0 10px;">
		                                <option value="">선택해주세요</option>
		                                <option value="부재시 경비실에 맡겨주세요">부재시 경비실에 맡겨주세요</option>
		                                <option value="부재시 전화 또는 문자 주세요">부재시 전화 또는 문자 주세요</option>
		                                <option value="배송 전 연락주세요">배송 전 연락주세요</option>
		                                <option value="택배함에 넣어주세요">택배함에 넣어주세요</option>
		                                <option value="파손위험 상품, 배송 주의해주세요">파손위험 상품, 배송 주의해주세요</option>
		                            </select>
		                            <button id="custom-request-btn" class="btn btn-outline-primary" style="white-space:nowrap;">직접 입력</button>
		                        </div>
		                        <div id="custom-request-container" style="display:none; margin-top:10px;">
		                            <div class="address-line">
		                                <input type="text" id="custom-request-input" class="form-control" placeholder="직접 입력해주세요 (최대 50자)" style="flex:1; margin-right:10px;">
		                                <button id="save-custom-request" class="btn btn-primary">확인</button>
		                            </div>
		                        </div>
		                        <div id="selected-request-display" class="address-line" style="display:none; margin-top:10px;">
		                            <span class="address-label">요청사항</span>
		                            <span id="request-text"></span>
		                        </div>
		                    </div>
		                `;
		
		                // 직접 입력 버튼 이벤트 핸들러
		                document.getElementById('custom-request-btn').addEventListener('click', function() {
		                    document.getElementById('delivery-request-select').value = '';
		                    document.getElementById('custom-request-container').style.display = 'block';
		                    document.getElementById('selected-request-display').style.display = 'none';
		                    document.getElementById('custom-request-input').focus();
		                });
		
		                // 직접 입력 확인 버튼 이벤트 핸들러
		                document.getElementById('save-custom-request').addEventListener('click', function() {
		                    const customInput = document.getElementById('custom-request-input');
		                    const customValue = customInput.value.trim();
		                    
		                    if (customValue) {
		                        document.getElementById('selected-request-display').style.display = 'flex';
		                        document.getElementById('request-text').textContent = customValue;
		                        document.getElementById('custom-request-container').style.display = 'none';
		                    } else {
		                        alert('직접 입력 내용을 작성해주세요.');
		                    }
		                });
		
		                // 배송 요청사항 선택 이벤트 핸들러
		                document.getElementById('delivery-request-select').addEventListener('change', function() {
		                    const selectedValue = this.value;
		                    const selectedDisplay = document.getElementById('selected-request-display');
		                    
		                    if (selectedValue) {
		                        selectedDisplay.style.display = 'flex';
		                        document.getElementById('request-text').textContent = selectedValue;
		                        document.getElementById('custom-request-container').style.display = 'none';
		                    } else {
		                        selectedDisplay.style.display = 'none';
		                    }
		                });
		
		                // 저장 버튼 이벤트 핸들러 추가
		                document.getElementById('confirm-detail-btn').addEventListener('click', function() {
		                    const detailInput = document.getElementById('detail-address-input');
		                    const detailAddressValue = detailInput.value.trim();
		                    
		                    if (detailAddressValue) {
		                        // 상세주소 표시 영역 업데이트
		                        document.getElementById('detail-address-display').style.display = 'flex';
		                        document.getElementById('detail-address-text').textContent = detailAddressValue;
		                        
		                        // 입력 필드 숨기기
		                        document.querySelector('.address-input-container').style.display = 'none';
		                        
		                        // 배송 요청사항 처리
		                        const requestText = document.getElementById('request-text').textContent;
		                        
		                        // 성공 메시지 추가
		                        addressDisplay.insertAdjacentHTML('beforeend', `
		                            <div class="address-success">
		                                <i class="fas fa-check-circle"></i>
		                                <span>배송지가 성공적으로 등록되었습니다</span>
		                                ${requestText ? `<div class="delivery-request-result" style="margin-top:5px;">
		                                    <span class="address-label">요청사항</span>
		                                    <span>${requestText}</span>
		                                </div>` : ''}
		                            </div>
		                        `);
		                    } else {
		                        alert('상세주소를 입력해주세요.');
		                    }
		                });
		
		                // 상세주소 입력 필드에 자동 포커스
		                document.getElementById('detail-address-input').focus();
		            }
		        }).open();
		    });
		});

	</script>


    <script th:src="@{'//dapi.kakao.com/v2/maps/sdk.js?appkey=0ab7f19c8492cbdd75c80c0e6d922e48&libraries=services'}"></script>
    <script>
	 	// checkout.html 최상단에 추가
	    if (!sessionStorage.getItem('cart_data')) {
	      alert("장바구니가 비었습니다!");
	      window.location.href = '/cart.html'; // 강제 리디렉션
	    }
    </script>
    <style>
    	/* 기본 스타일 */
	    body { font-family: Arial, sans-serif; margin: 20px; }
	    .form-group { margin-bottom: 15px; }
	    label { display: block; margin-bottom: 5px; font-weight: bold; }
	    input[type="text"] { width: 350px; padding: 8px; border: 1px solid #ccc; border-radius: 4px; }
	    .addr-search-btn { padding: 8px 15px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; margin-left: 10px;}
	    .addr-search-btn:hover { background-color: #0056b3; }
	    #map { width: 100%; height: 400px; margin-top: 20px; border: 1px solid #ddd; } /* 지도를 표시할 영역 스타일 */
    
    	.checkout-container {
		    width: 100%;
		    max-width: 800px;
		    background-color: #ffffff;
		    border: 1px solid #e9ecef;
		    border-radius: 8px;
		    padding: 24px;
		    box-sizing: border-box;
		}
		
		.section {
		    margin-bottom: 20px;
		}
		
		/* 헤더 (제목과 버튼) */
		.section-header {
		    display: flex;
		    justify-content: space-between;
		    align-items: center;
		    margin-bottom: 16px;
		}
		
		.section-header h2 {
		    font-size: 20px;
		    font-weight: bold;
		    margin: 0;
		}
		
		#register-address-btn {
		    font-size: 14px;
		    padding: 8px 12px;
		    border: 1px solid #ced4da;
		    border-radius: 4px;
		    background-color: #ffffff;
		    cursor: pointer;
		    transition: background-color 0.2s;
		}
		
		#register-address-btn:hover {
		    background-color: #f1f3f5;
		}
		
		/* 배송지 표시 영역 */
		#address-display {
		    min-height: 100px; /* 내용이 없을 때도 높이 유지 */
		    display: flex;
		    flex-direction: column;
		    justify-content: center;
		    align-items: center;
		}
		
		/* 초기 안내 메시지 스타일 */
		.address-content-placeholder p {
		    margin: 4px 0;
		    color: #868e96;
		    font-size: 15px;
		}
		
		/* 기존 스타일 유지하고 아래 내용 추가 */
		.address-info {
		    width: 100%;
		    padding: 20px;
		    background-color: #f9f9f9;
		    border-radius: 8px;
		    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
		}
		
		.address-info p {
		    margin: 10px 0;
		    font-size: 16px;
		    line-height: 1.6;
		    display: flex;
		    align-items: center;
		}
		
		.address-info .postcode {
		    font-weight: bold;
		    color: #cc9966;
		    font-size: 18px;
		    margin-right: 10px;
		}
		
		.address-info .address-label {
		    display: inline-block;
		    width: 80px;
		    font-weight: 500;
		    color: #666;
		}
		
		.address-line {
		    display: flex;
		    align-items: center;
		    margin-bottom: 8px;
		}
		
		.address-input-container {
		    display: flex;
		    gap: 10px;
		    margin-top: 15px;
		    align-items: center;
		}
		
		.address-input-container input {
		    flex: 1;
		    padding: 10px 15px;
		    border: 1px solid #ddd;
		    border-radius: 4px;
		    font-size: 14px;
		}
		
		.address-input-container button {
		    padding: 10px 20px;
		    background-color: #cc9966;
		    color: white;
		    border: none;
		    border-radius: 4px;
		    cursor: pointer;
		    transition: background-color 0.3s;
		}
		
		.address-input-container button:hover {
		    background-color: #b58252;
		}
		
		.address-success {
		    margin-top: 15px;
		    padding: 10px;
		    background-color: #e8f5e9;
		    color: #2e7d32;
		    border-radius: 4px;
		    display: flex;
		    align-items: center;
		    gap: 8px;
		}
		
		.address-success i {
		    font-size: 18px;
		}
		
		/* 배송 요청사항 관련 추가 스타일 */
	    .delivery-request-section {
	        margin-top: 20px;
	        padding-top: 15px;
	        border-top: 1px dashed #e0e0e0;
	    }
	    
	    #delivery-request-select {
	        width: 100%;
	        padding: 10px;
	        border: 1px solid #ddd;
	        border-radius: 4px;
	    }
	    
	    #custom-request-input {
	        width: 100%;
	        padding: 10px;
	        border: 1px solid #ddd;
	        border-radius: 4px;
	        resize: vertical;
	    }
	    
	    .delivery-request-result {
	        margin-top: 10px;
	        padding: 10px;
	        background-color: #f8f9fa;
	        border-radius: 4px;
	    }	
		
		/* 구분선 */
		.divider {
		    border: none;
		    border-top: 1px solid #e9ecef;
		    margin: 24px 0;
		}
    </style>
</head>

<body>
<th:block layout:fragment="contents">
    <div class="page-wrapper">

        <main class="main">
        	<div class="page-header text-center" style="background-image: url('maincss/assets/images/page-header-bg.jpg')">
        		<div class="container">
        			<h1 class="page-title">Checkout<span>Shop</span></h1>
        		</div></div><nav aria-label="breadcrumb" class="breadcrumb-nav">
                <div class="container">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="index.html">Home</a></li>
                        <li class="breadcrumb-item"><a href="#">Shop</a></li>
                        <li class="breadcrumb-item active" aria-current="page">Checkout</li>
                    </ol>
                </div></nav><div class="page-content">
            	<div class="checkout">
	                <div class="container">
            			<div class="checkout-discount">
            				<form action="#">
        						<input type="text" class="form-control" required id="checkout-discount-input">
            					<label for="checkout-discount-input" class="text-truncate">Have a coupon? <span>Click here to enter your code</span></label>
            				</form>
            			</div><form action="#">
		                	<div class="row">
		                		<div class="col-lg-9">
		                			<div class="checkout-container">
								        <div class="section">
								            <div class="section-header">
								                <h2>배송지</h2>
								                <button id="register-address-btn">배송지 등록</button>
								            </div>
								            <div id="address-display" class="address-content-placeholder">
								                <p>등록된 배송지가 없습니다.</p>
								                <p>배송지를 등록해 주세요.</p>
								            </div>
								        </div>
								
								        <hr class="divider">
								
								        <div class="section">
								            <div class="section-header">
								                <h2>주문 상품</h2>
								            </div>
								            </div>
								    </div>
								
								    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js?appkey=0ab7f19c8492cbdd75c80c0e6d922e48"></script>
								    <!-- <script src="maincss/assets/js/script.js"></script>   -->
							    </div><aside class="col-lg-3">
		                			<div class="summary">
		                				<h3 class="summary-title">Your Order</h3><table class="table table-summary">
										  <tbody id="checkoutProducts">
										    </tbody>
										  	<tbody> 
											  	<tr class="summary-subtotal"> 
											  		<td>Subtotal:</td>
											    	<td id="checkoutSubtotal">$548.00</td>
											   	</tr>
											   	<tr class="summary-total"> 
											   		<td>Total:</td>
											     	<td id="checkoutTotal">$548.00</td>
											   	</tr>
									    	</tbody>
										</table>
										
		                				<div class="accordion-summary" id="accordion-payment">
										    <div class="card">
										        <div class="card-header" id="heading-1">
										            <h2 class="card-title">
										                <a role="button" data-toggle="collapse" href="#collapse-1" aria-expanded="true" aria-controls="collapse-1">
										                    Direct bank transfer
										                </a>
										            </h2>
										        </div><div id="collapse-1" class="collapse show" aria-labelledby="heading-1" data-parent="#accordion-payment">
										            <div class="card-body">
										                Make your payment directly into our bank account. Please use your Order ID as the payment reference. Your order will not be shipped until the funds have cleared in our account.
										            </div></div></div><div class="card">
										        <div class="card-header" id="heading-2">
										            <h2 class="card-title">
										                <a class="collapsed" role="button" data-toggle="collapse" href="#collapse-2" aria-expanded="false" aria-controls="collapse-2">
										                    Check payments
										                </a>
										            </h2>
										        </div><div id="collapse-2" class="collapse" aria-labelledby="heading-2" data-parent="#accordion-payment">
										            <div class="card-body">
										                Ipsum dolor sit amet, consectetuer adipiscing elit. Donec odio. Quisque volutpat mattis eros. Nullam malesuada erat ut turpis. 
										            </div></div></div><div class="card">
										        <div class="card-header" id="heading-3">
										            <h2 class="card-title">
										                <a class="collapsed" role="button" data-toggle="collapse" href="#collapse-3" aria-expanded="false" aria-controls="collapse-3">
										                    Cash on delivery
										                </a>
										            </h2>
										        </div><div id="collapse-3" class="collapse" aria-labelledby="heading-3" data-parent="#accordion-payment">
										            <div class="card-body">Quisque volutpat mattis eros. Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Donec odio. Quisque volutpat mattis eros. 
										            </div></div></div><div class="card">
										        <div class="card-header" id="heading-4">
										            <h2 class="card-title">
										                <a class="collapsed" role="button" data-toggle="collapse" href="#collapse-4" aria-expanded="false" aria-controls="collapse-4">
										                    PayPal <small class="float-right paypal-link">What is PayPal?</small>
										                </a>
										            </h2>
										        </div><div id="collapse-4" class="collapse" aria-labelledby="heading-4" data-parent="#accordion-payment">
										            <div class="card-body">
										                Nullam malesuada erat ut turpis. Suspendisse urna nibh, viverra non, semper suscipit, posuere a, pede. Donec nec justo eget felis facilisis fermentum.
										            </div></div></div><div class="card">
										        <div class="card-header" id="heading-5">
										            <h2 class="card-title">
										                <a class="collapsed" role="button" data-toggle="collapse" href="#collapse-5" aria-expanded="false" aria-controls="collapse-5">
										                    Credit Card (Stripe)
										                    <img src="maincss/assets/images/payments-summary.png" alt="payments cards">
										                </a>
										            </h2>
										        </div><div id="collapse-5" class="collapse" aria-labelledby="heading-5" data-parent="#accordion-payment">
										            <div class="card-body"> Donec nec justo eget felis facilisis fermentum.Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Donec odio. Quisque volutpat mattis eros. Lorem ipsum dolor sit ame.
										            </div></div></div></div>
										<button id="payment-button" type="button" class="btn btn-outline-primary-2 btn-order btn-block">
		                					<span class="btn-text">Place Order</span>
		                					<span class="btn-hover-text">Proceed to Checkout</span>
		                				</button>
										
		                			</div></aside></div></form>
		                			
		                			
	                </div></div></div></main></div><button id="scroll-top" title="Back to Top"><i class="icon-arrow-up"></i></button>

    <div class="mobile-menu-overlay"></div><div class="mobile-menu-container">
        <div class="mobile-menu-wrapper">
            <span class="mobile-menu-close"><i class="icon-close"></i></span>

            <form action="#" method="get" class="mobile-search">
                <label for="mobile-search" class="sr-only">Search</label>
                <input type="search" class="form-control" name="mobile-search" id="mobile-search" placeholder="Search in..." required>
                <button class="btn btn-primary" type="submit"><i class="icon-search"></i></button>
            </form>
            
            <nav class="mobile-nav">
                <ul class="mobile-menu">
                    <li class="active">
                        <a href="index.html">Home</a>

                        <ul>
                            <li><a href="index-1.html">01 - furniture store</a></li>
                            <li><a href="index-2.html">02 - furniture store</a></li>
                            <li><a href="index-3.html">03 - electronic store</a></li>
                            <li><a href="index-4.html">04 - electronic store</a></li>
                            <li><a href="index-5.html">05 - fashion store</a></li>
                            <li><a href="index-6.html">06 - fashion store</a></li>
                            <li><a href="index-7.html">07 - fashion store</a></li>
                            <li><a href="index-8.html">08 - fashion store</a></li>
                            <li><a href="index-9.html">09 - fashion store</a></li>
                            <li><a href="index-10.html">10 - shoes store</a></li>
                            <li><a href="index-11.html">11 - furniture simple store</a></li>
                            <li><a href="index-12.html">12 - fashion simple store</a></li>
                            <li><a href="index-13.html">13 - market</a></li>
                            <li><a href="index-14.html">14 - market fullwidth</a></li>
                            <li><a href="index-15.html">15 - lookbook 1</a></li>
                            <li><a href="index-16.html">16 - lookbook 2</a></li>
                            <li><a href="index-17.html">17 - fashion store</a></li>
                            <li><a href="index-18.html">18 - fashion store (with sidebar)</a></li>
                            <li><a href="index-19.html">19 - games store</a></li>
                            <li><a href="index-20.html">20 - book store</a></li>
                            <li><a href="index-21.html">21 - sport store</a></li>
                            <li><a href="index-22.html">22 - tools store</a></li>
                            <li><a href="index-23.html">23 - fashion left navigation store</a></li>
                            <li><a href="index-24.html">24 - extreme sport store</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="category.html">Shop</a>
                        <ul>
                            <li><a href="category-list.html">Shop List</a></li>
                            <li><a href="category-2cols.html">Shop Grid 2 Columns</a></li>
                            <li><a href="category.html">Shop Grid 3 Columns</a></li>
                            <li><a href="category-4cols.html">Shop Grid 4 Columns</a></li>
                            <li><a href="category-boxed.html"><span>Shop Boxed No Sidebar<span class="tip tip-hot">Hot</span></span></a></li>
                            <li><a href="category-fullwidth.html">Shop Fullwidth No Sidebar</a></li>
                            <li><a href="product-category-boxed.html">Product Category Boxed</a></li>
                            <li><a href="product-category-fullwidth.html"><span>Product Category Fullwidth<span class="tip tip-new">New</span></span></a></li>
                            <li><a href="cart.html">Cart</a></li>
                            <li><a href="checkout.html">Checkout</a></li>
                            <li><a href="wishlist.html">Wishlist</a></li>
                            <li><a href="#">Lookbook</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="product.html" class="sf-with-ul">Product</a>
                        <ul>
                            <li><a href="product.html">Default</a></li>
                            <li><a href="product-centered.html">Centered</a></li>
                            <li><a href="product-extended.html"><span>Extended Info<span class="tip tip-new">New</span></span></a></li>
                            <li><a href="product-gallery.html">Gallery</a></li>
                            <li><a href="product-sticky.html">Sticky Info</a></li>
                            <li><a href="product-sidebar.html">Boxed With Sidebar</a></li>
                            <li><a href="product-fullwidth.html">Full Width</a></li>
                            <li><a href="product-masonry.html">Masonry Sticky Info</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="#">Pages</a>
                        <ul>
                            <li>
                                <a href="about.html">About</a>

                                <ul>
                                    <li><a href="about.html">About 01</a></li>
                                    <li><a href="about-2.html">About 02</a></li>
                                </ul>
                            </li>
                            <li>
                                <a href="contact.html">Contact</a>

                                <ul>
                                    <li><a href="contact.html">Contact 01</a></li>
                                    <li><a href="contact-2.html">Contact 02</a></li>
                                </ul>
                            </li>
                            <li><a href="login.html">Login</a></li>
                            <li><a href="faq.html">FAQs</a></li>
                            <li><a href="404.html">Error 404</a></li>
                            <li><a href="coming-soon.html">Coming Soon</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="blog.html">Blog</a>

                        <ul>
                            <li><a href="blog.html">Classic</a></li>
                            <li><a href="blog-listing.html">Listing</a></li>
                            <li>
                                <a href="#">Grid</a>
                                <ul>
                                    <li><a href="blog-grid-2cols.html">Grid 2 columns</a></li>
                                    <li><a href="blog-grid-3cols.html">Grid 3 columns</a></li>
                                    <li><a href="blog-grid-4cols.html">Grid 4 columns</a></li>
                                    <li><a href="blog-grid-sidebar.html">Grid sidebar</a></li>
                                </ul>
                            </li>
                            <li>
                                <a href="#">Masonry</a>
                                <ul>
                                    <li><a href="blog-masonry-2cols.html">Masonry 2 columns</a></li>
                                    <li><a href="blog-masonry-3cols.html">Masonry 3 columns</a></li>
                                    <li><a href="blog-masonry-4cols.html">Masonry 4 columns</a></li>
                                    <li><a href="blog-masonry-sidebar.html">Masonry sidebar</a></li>
                                </ul>
                            </li>
                            <li>
                                <a href="#">Mask</a>
                                <ul>
                                    <li><a href="blog-mask-grid.html">Blog mask grid</a></li>
                                    <li><a href="blog-mask-masonry.html">Blog mask masonry</a></li>
                                </ul>
                            </li>
                            <li>
                                <a href="#">Single Post</a>
                                <ul>
                                    <li><a href="single.html">Default with sidebar</a></li>
                                    <li><a href="single-fullwidth.html">Fullwidth no sidebar</a></li>
                                    <li><a href="single-fullwidth-sidebar.html">Fullwidth with sidebar</a></li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <a href="elements-list.html">Elements</a>
                        <ul>
                            <li><a href="elements-products.html">Products</a></li>
                            <li><a href="elements-typography.html">Typography</a></li>
                            <li><a href="elements-titles.html">Titles</a></li>
                            <li><a href="elements-banners.html">Banners</a></li>
                            <li><a href="elements-product-category.html">Product Category</a></li>
                            <li><a href="elements-video-banners.html">Video Banners</a></li>
                            <li><a href="elements-buttons.html">Buttons</a></li>
                            <li><a href="elements-accordions.html">Accordions</a></li>
                            <li><a href="elements-tabs.html">Tabs</a></li>
                            <li><a href="elements-testimonials.html">Testimonials</a></li>
                            <li><a href="elements-blog-posts.html">Blog Posts</a></li>
                            <li><a href="elements-portfolio.html">Portfolio</a></li>
                            <li><a href="elements-cta.html">Call to Action</a></li>
                            <li><a href="elements-icon-boxes.html">Icon Boxes</a></li>
                        </ul>
                    </li>
                </ul>
            </nav><div class="social-icons">
                <a href="#" class="social-icon" target="_blank" title="Facebook"><i class="icon-facebook-f"></i></a>
                <a href="#" class="social-icon" target="_blank" title="Twitter"><i class="icon-twitter"></i></a>
                <a href="#" class="social-icon" target="_blank" title="Instagram"><i class="icon-instagram"></i></a>
                <a href="#" class="social-icon" target="_blank" title="Youtube"><i class="icon-youtube"></i></a>
            </div></div></div><div class="modal fade" id="signin-modal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-body">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true"><i class="icon-close"></i></span>
                    </button>

                    <div class="form-box">
                        <div class="form-tab">
                            <ul class="nav nav-pills nav-fill" role="tablist">
                                <li class="nav-item">
                                    <a class="nav-link active" id="signin-tab" data-toggle="tab" href="#signin" role="tab" aria-controls="signin" aria-selected="true">Sign In</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" id="register-tab" data-toggle="tab" href="#register" role="tab" aria-controls="register" aria-selected="false">Register</a>
                                </li>
                            </ul>
                            <div class="tab-content" id="tab-content-5">
                                <div class="tab-pane fade show active" id="signin" role="tabpanel" aria-labelledby="signin-tab">
                                    <form action="#">
                                        <div class="form-group">
                                            <label for="singin-email">Username or email address *</label>
                                            <input type="text" class="form-control" id="singin-email" name="singin-email" required>
                                        </div><div class="form-group">
                                            <label for="singin-password">Password *</label>
                                            <input type="password" class="form-control" id="singin-password" name="singin-password" required>
                                        </div><div class="form-footer">
                                            <button type="submit" class="btn btn-outline-primary-2">
                                                <span>LOG IN</span>
                                                <i class="icon-long-arrow-right"></i>
                                            </button>

                                            <div class="custom-control custom-checkbox">
                                                <input type="checkbox" class="custom-control-input" id="signin-remember">
                                                <label class="custom-control-label" for="signin-remember">Remember Me</label>
                                            </div><a href="#" class="forgot-link">Forgot Your Password?</a>
                                        </div></form>
                                    <div class="form-choice">
                                        <p class="text-center">or sign in with</p>
                                        <div class="row">
                                            <div class="col-sm-6">
                                                <a href="#" class="btn btn-login btn-g">
                                                    <i class="icon-google"></i>
                                                    Login With Google
                                                </a>
                                            </div><div class="col-sm-6">
                                                <a href="#" class="btn btn-login btn-f">
                                                    <i class="icon-facebook-f"></i>
                                                    Login With Facebook
                                                </a>
                                            </div></div></div></div><div class="tab-pane fade" id="register" role="tabpanel" aria-labelledby="register-tab">
                                    <form action="#">
                                        <div class="form-group">
                                            <label for="register-email">Your email address *</label>
                                            <input type="email" class="form-control" id="register-email" name="register-email" required>
                                        </div><div class="form-group">
                                            <label for="register-password">Password *</label>
                                            <input type="password" class="form-control" id="register-password" name="register-password" required>
                                        </div><div class="form-footer">
                                            <button type="submit" class="btn btn-outline-primary-2">
                                                <span>SIGN UP</span>
                                                <i class="icon-long-arrow-right"></i>
                                            </button>

                                            <div class="custom-control custom-checkbox">
                                                <input type="checkbox" class="custom-control-input" id="register-policy" required>
                                                <label class="custom-control-label" for="register-policy">I agree to the <a href="#">privacy policy</a> *</label>
                                            </div></div></form>
                                    <div class="form-choice">
                                        <p class="text-center">or sign in with</p>
                                        <div class="row">
                                            <div class="col-sm-6">
                                                <a href="#" class="btn btn-login btn-g">
                                                    <i class="icon-google"></i>
                                                    Login With Google
                                                </a>
                                            </div><div class="col-sm-6">
                                                <a href="#" class="btn btn-login  btn-f">
                                                    <i class="icon-facebook-f"></i>
                                                    Login With Facebook
                                                </a>
                                            </div>
                                           </div></div></div></div></div></div></div></div></div></div>    

    <script src="maincss/assets/js/jquery.min.js"></script>
    <script src="maincss/assets/js/bootstrap.bundle.min.js"></script>
    <script src="maincss/assets/js/jquery.hoverIntent.min.js"></script>
    <script src="maincss/assets/js/jquery.waypoints.min.js"></script>
    <script src="maincss/assets/js/superfish.min.js"></script>
    <script src="maincss/assets/js/owl.carousel.min.js"></script>
    <script src="maincss/assets/js/bootstrap-input-spinner.js"></script>
    <script src="maincss/assets/js/main.js"></script>
	<script>
		document.addEventListener('DOMContentLoaded', function() {
		    // 1. 장바구니 데이터 가져오기
		    const cartDataString = sessionStorage.getItem('cart_data');
		    if (!cartDataString) {
		        alert("장바구니가 비어 있습니다.");
		        window.location.href = 'cart.html';
		        return;
		    }
		
		    const cartData = JSON.parse(cartDataString);
		    const checkoutProductsTbody = document.getElementById('checkoutProducts');
		
		    // 2. 기존 목록 초기화
		    checkoutProductsTbody.innerHTML = '';
		
		    // 3. 상품 목록 추가 (최대 2개만 표시)
		    const maxDisplayItems = 2;
		    const displayedProducts = cartData.products.slice(0, maxDisplayItems); // 처음 2개 상품만 선택
		
		    displayedProducts.forEach(product => {
		        const row = checkoutProductsTbody.insertRow();
		        row.innerHTML = `
		            <td>${product.name} × ${product.quantity}</td>
		            <td>$${product.total.toFixed(2)}</td>
		        `;
		    });
		
		    // 4. Subtotal과 Total만 표시 (기존 행 유지)
		    document.getElementById('checkoutSubtotal').textContent = `$${cartData.subtotal}`;
		    document.getElementById('checkoutTotal').textContent = `$${cartData.total}`;
		});
	</script>

<!-- =================================================================== -->
<!--     [새로운 스크립트] 장바구니 및 결제 로직 통합 스크립트     -->
<!-- =================================================================== -->
<script th:inline="javascript">
/*<![CDATA[*/

    // --- 페이지의 모든 HTML 요소가 로드된 후에 이 코드를 실행합니다. ---
    document.addEventListener('DOMContentLoaded', function() {
        
        console.log("체크아웃 페이지 스크립트 시작!");

        // --- 1. 장바구니 데이터 가져오기 및 금액/주문명 설정 ---
        const cartDataString = sessionStorage.getItem('cart_data');
        if (!cartDataString) {
            alert("장바구니 정보가 없습니다. 장바구니 페이지로 이동합니다.");
            window.location.href = '/cart';
            return;
        }
        
        const cartData = JSON.parse(cartDataString);
        const amount = cartData.total;
        const orderName = cartData.products.length > 1 
            ? `${cartData.products[0].name} 외 ${cartData.products.length - 1}건`
            : cartData.products[0].name;

        console.log("주문명:", orderName, "| 주문금액:", amount);

        // --- 2. 토스페이먼츠 위젯 초기화 및 렌더링 ---
    /**
     * [기능 2] 토스페이먼츠 위젯을 초기화하고, 결제 버튼에 기능을 연결합니다. (최종 수정)
     */
    function setupTossPayments(cartData) {
        const clientKey = /*[[${tossClientKey}]]*/ null;
        if (!clientKey) {
            alert("결제 연동 오류: 서버로부터 클라이언트 키를 받지 못했습니다.");
            return;
        }
        
        const amount = Math.round(cartData.total);
        const orderName = cartData.products.length > 1 
            ? `${cartData.products[0].name} 외 ${cartData.products.length - 1}건`
            : cartData.products[0].name;
        const customerKey = "checkout_" + new Date().getTime();

        // ★★★★★ 핵심 해결책 ★★★★★
        // paymentWidget 변수를 함수 최상단에 선언하여, 함수 내 어디서든 접근 가능하게 합니다.
        let paymentWidget; 
        
        try {
            // const를 빼고, 이미 선언된 paymentWidget 변수에 객체를 할당합니다.
            paymentWidget = PaymentWidget(clientKey, customerKey);

            // 약관 위젯 렌더링
            paymentWidget.renderAgreement("#agreement");

            // 결제 수단 위젯 렌더링
            paymentWidget.renderPaymentMethods(
                "#payment-section", 
                { value: amount }, 
                { variantKey: "DEFAULT" }
            );
        } catch (error) {
            alert("결제 모듈을 불러오는 데 실패했습니다: " + error.message);
            return; // 위젯 렌더링 실패 시, 버튼 이벤트 연결을 시도하지 않음
        }
        
        // '결제하기' 버튼에 기능 연결
        // 이제 이 함수는 상단에 선언된 paymentWidget 변수에 정상적으로 접근할 수 있습니다.
        $('#payment-button').on('click', function() {
            if (!isAddressValid()) return;
            
            paymentWidget.requestPayment({
                orderId: "order_" + new Date().getTime(),
                orderName: orderName,
                amount: amount,
                successUrl: window.location.origin + "/payment/success",
                failUrl: window.location.origin + "/payment/fail"
            }).catch(error => {
                if (error.code !== 'USER_CANCEL' && error.code !== 'PAYMENT_CREATION_FAILED') {
                    // "결제수단이 선택되지 않았어요"와 같은 일반적인 안내는 토스에서 처리하므로,
                    // 심각한 오류가 아닐 경우 alert를 띄우지 않을 수 있습니다.
                    // 필요하다면 아래 주석을 해제하세요.
                    // alert(error.message);
                }
            });
        });
    }

        // --- 3. "Place Order" 버튼에 클릭 이벤트 연결 (가장 중요!) ---
        const paymentButton = document.getElementById("payment-button");
        if (paymentButton) {
            console.log("결제 버튼을 찾았습니다. 이제 클릭 이벤트를 추가합니다.");
            
            paymentButton.addEventListener("click", function() {
                
                console.log("'Place Order' 버튼이 클릭되었습니다!"); // <-- 클릭 시 이 로그가 찍히는지 확인!

                // 배송지 정보가 유효한지 확인하는 로직
                const addressDisplay = document.getElementById("address-display");
                if (addressDisplay && addressDisplay.classList.contains("address-content-placeholder")) {
                    alert("배송지를 먼저 등록해주세요.");
                    return; // 함수 실행 중단
                }
                const detailAddress = document.getElementById("detail-address-text");
                if (!detailAddress || !detailAddress.textContent) {
                    alert("상세주소를 입력하고 [저장] 버튼을 눌러주세요.");
                    return; // 함수 실행 중단
                }
                
                console.log("배송지 정보 유효함. 결제 요청을 시작합니다.");
                
                console.log("토스페이먼츠 requestPayment 호출 직전!"); 

                // 토스페이먼츠 결제 요청 실행
                paymentWidget.requestPayment({
                    orderId: "order_" + new Date().getTime(),
                    orderName: orderName,
                    amount: amount,
                    successUrl: window.location.origin + "/payment/success",
                    failUrl: window.location.origin + "/payment/fail",
                    customerEmail: "customer@example.com",
                    customerName: "김토스"
                })
                .catch(function (error) {
                    // 사용자가 결제를 취소한 경우는 무시
                    if (error.code !== 'USER_CANCEL') {
                        console.error("결제 요청 실패:", error);
                        alert("결제 요청 중 오류가 발생했습니다: " + error.message);
                    } else {
                        console.log("사용자가 결제를 취소했습니다.");
                    }
                });

            });
        } else {
            console.error("결제 버튼(id='payment-button')을 HTML에서 찾을 수 없습니다!");
            alert("결제 버튼을 찾을 수 없습니다. HTML 코드를 확인해주세요.");
        }
    });

/*]]>*/
</script>
</th:block>

</body>


</html>