<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{admin/layout/layoutMain}">

<head>
    <meta name="appDetail" content="appDetail" />
    <th:block layout:fragment="customCss">
        <link rel="stylesheet" th:href="@{/admincss/assets/customadmincss/adminInquiryDetailView.css}">
        <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    </th:block>
</head>

<th:block layout:fragment="jsFile"></th:block>

<th:block layout:fragment="contents">
    <div class="content-header">
        <div>
            <h2 class="content-title card-title">어드민 문의 상세</h2>
        </div>
    </div>
    <div class="card">
        <div class="card-body">
            <div class="container">
                <!-- 문의 상세 정보 프래그먼트 -->
                <div th:replace="~{common/fragments/inquiryDetailFragment :: inquiryDetailFragment(inquiryData=${inquiryDetail})}"></div>

                <!--
                    [수정] 페이지 액션 버튼 그룹 (수정, 목록)
                    - '답변 수정'과 '목록으로' 버튼을 하나의 div로 묶어 관리합니다.
                -->
                <div class="page-actions d-flex justify-content-end align-items-center gap-2 mt-3">
                    <!-- 답변이 있을 때만 '답변 수정' 버튼이 보입니다. -->
                    <button type="button" id="startEditBtn" class="btn btn-custom-neutral" th:if="${inquiryDetail.answer != null}">답변 수정</button>

                    <!-- 요청 2: '목록으로' 버튼 추가 (항상 보임) -->
                    <!-- TODO: th:href="@{...}" 안에 실제 관리자 문의 목록 페이지 URL을 넣어주세요. -->
                    <a th:href="@{/admin/inquiry/adminInquiryList}" class="btn btn-custom-neutral">목록으로</a>
                </div>


                <!-- 답변 작성 / 수정 프래그먼트 호출 -->
                <th:block th:if="${inquiryDetail.answer == null}">
                    <div th:replace="~{common/fragments/AnswerFragment :: AnswerFragment(inquiryData=${inquiryDetail}, isEditMode=false, answerApiUrl=@{/admin/inquiry/answer})}"></div>
                </th:block>
                <th:block th:unless="${inquiryDetail.answer == null}">
                    <div id="answerFormWrapper" style="display: none;">
                        <div th:replace="~{common/fragments/AnswerFragment :: AnswerFragment(inquiryData=${inquiryDetail}, isEditMode=true, answerApiUrl=@{/admin/inquiry/answer})}"></div>
                    </div>
                </th:block>
            </div>
        </div>
    </div>
</th:block>

<th:block layout:fragment="jsScript">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.js"></script>
    <script th:inline="javascript">
    document.addEventListener('DOMContentLoaded', function() {	
        const startEditBtn = document.getElementById('startEditBtn');
        const answerFormWrapper = document.getElementById('answerFormWrapper');
        const cancelEditBtn = document.querySelector('#answerFormWrapper #cancelEditBtn');

        // '수정' 버튼 클릭 시 이벤트
        if (startEditBtn && answerFormWrapper) {
            startEditBtn.addEventListener('click', function() {
                answerFormWrapper.style.display = 'block';
                startEditBtn.style.display = 'none'; // '답변 수정' 버튼 숨김
            });
        }

        // '취소' 버튼 클릭 시 이벤트
        if (cancelEditBtn && answerFormWrapper && startEditBtn) {
            cancelEditBtn.addEventListener('click', function() {
                answerFormWrapper.style.display = 'none';
                startEditBtn.style.display = 'inline-block'; // '답변 수정' 버튼 다시 보이기
            });
        }
    });
    </script>
</th:block>

</html>