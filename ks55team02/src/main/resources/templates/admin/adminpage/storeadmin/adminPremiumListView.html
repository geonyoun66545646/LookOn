<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org/"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{admin/layout/layoutMain}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>관리자 - 구독 플랜 목록</title>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" th:href="@{/admincss/assets/css/customadminpagecss/userList.css}">
    <style>
        .main-content {
            padding: 20px;
        }
        .content-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
        }
        .table-responsive {
            overflow-x: auto;
        }
        .member-table {
            width: 100%;
            border-collapse: collapse;
        }
        .member-table th, .member-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e0e0e0;
        }
        .member-table th {
            background-color: #f8f9fa;
            font-weight: 600;
        }
        .ellipsis {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 200px;
        }
        /* 버튼 공통 스타일 */
        .btn-outline {
            background-color: transparent;
            border: 1px solid;
            transition: all 0.3s ease;
        }
        .btn-outline-primary {
            color: #007bff;
            border-color: #007bff;
        }
        .btn-outline-primary:hover {
            background-color: #007bff;
            color: white;
        }
        .btn-outline-danger {
            color: #dc3545;
            border-color: #dc3545;
        }
        .btn-outline-danger:hover {
            background-color: #dc3545;
            color: white;
        }
        .text-brand {
            color: #28a745;
            font-weight: bold;
        }
    </style>
</head>
<body>
<th:block layout:fragment="contents">
    <main class="main-content">
        <section class="content-header">
            <h2 class="content-title">구독 플랜 목록</h2>
        </section>

        <div class="card">
            <div class="card-body">
                <div class="row gx-3 align-items-center mb-4">
                    <div class="col-md-6">

                    </div>
                    <div class="col-md-6 text-end">
                        <a th:href="@{/adminpage/storeadmin/premiumAdd}" class="btn btn-primary">
                            <i class="material-icons md-add"></i> 새 플랜 등록
                        </a>
                    </div>
                </div>

                <div class="table-responsive">
                    <table class="table table-hover member-table">
                        <thead>
                            <tr class="text-center">
                                <th scope="col">플랜 명칭</th>
                                <th scope="col">가격</th>
                                <th scope="col">기간 (일)</th>
                                <th scope="col">설명</th>
                                <th scope="col">생성 일자</th>
                                <th scope="col">관리</th>
                            </tr>
                        </thead>
                        <tbody class="text-center">
                            <tr th:if="${#lists.isEmpty(plans)}">
                                <td colspan="6" class="text-center py-5">등록된 구독 플랜이 없습니다.</td>
                            </tr>
                            <tr th:unless="${#lists.isEmpty(plans)}" th:each="plan : ${plans}">
                                <td th:text="${plan.sbscrPlanNm}"></td>
                                <td th:text="${#numbers.formatCurrency(plan.sbscrPlanPrc)} + '원'"></td>
                                <td th:text="${plan.sbscrPlanTermVal} + '일'"></td>
                                <td class="ellipsis text" th:text="${plan.sbscrPlanExpln}" th:title="${plan.sbscrPlanExpln}"></td>
                                <td th:text="${#temporals.format(plan.sbscrPlanCrtDt, 'yyyy-MM-dd')}"></td>
                                <td>
                                    <a th:href="@{/adminpage/storeadmin/premiumModify/{id}(id=${plan.sbscrPlanId})}"
                                       class="btn btn-sm btn-outline-primary">
                                       <i class="fas fa-edit me-1"></i> 수정
                                    </a>
                                    <button class="btn btn-sm btn-outline-danger delete-btn"
                                            th:data-plan-id="${plan.sbscrPlanId}"     
                                            th:data-plan-name="${plan.sbscrPlanNm}">
                                        <i class="fas fa-trash-alt me-1"></i> 삭제
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>
    <script th:inline="javascript">
        /*<![CDATA[*/
        document.addEventListener('DOMContentLoaded', function() {
            const deleteButtons = document.querySelectorAll('.delete-btn');

            deleteButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const planId = this.dataset.planId;
                    const planName = this.dataset.planName;

                    Swal.fire({
                        title: '정말 삭제하시겠습니까?',
                        text: "'" + planName + "' 플랜을 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다.",
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonColor: '#d33',
                        cancelButtonColor: '#6c757d',
                        confirmButtonText: '네, 삭제합니다!',
                        cancelButtonText: '취소'
                    }).then((result) => {
                        if (result.isConfirmed) {
                            // AJAX 요청으로 삭제 처리
                            fetch('/adminpage/storeadmin/premiumDelete/' + planId, {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'X-Requested-With': 'XMLHttpRequest'
                                }
                            })
                            .then(response => {
                                if (!response.ok) {
                                    return response.text().then(text => { throw new Error(text) });
                                }
                                return response.json();
                            })
                            .then(data => {
                                if (data.success) {
                                    Swal.fire(
                                        '삭제 완료!',
                                        data.message,
                                        'success'
                                    ).then(() => {
                                        window.location.reload();
                                    });
                                } else {
                                    Swal.fire(
                                        '삭제 실패!',
                                        data.message,
                                        'error'
                                    );
                                }
                            })
                            .catch(error => {
                                console.error('Error:', error);
                                Swal.fire(
                                    '오류 발생!',
                                    '삭제 중 오류가 발생했습니다: ' + error.message,
                                    'error'
                                );
                            });
                        }
                    });
                });
            });
        });
        /*]]>*/
    </script> 
</th:block>
</body>
</html>