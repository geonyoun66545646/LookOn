<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="~{/admin/layout/layoutMain}">
		
	 <head>
	 	<meta name="description" content="한국스마트정보교육원 ksmybatis" />
	 </head>
	 <!--/* 개발시 추가할 jsfile 영역 정의 */-->
	 <th:block layout:fragment="jsFile">
	 </th:block>
	 
	 <!--/* 개발시 추가할 스크립트 */-->
	 <th:block layout:fragment="jsScript">	 
	 </th:block>
	 <!-- 추가할 페이지 contents -->
	 <th:block layout:fragment="contents">
	 	<body>


    <!-- ================================================== -->
<!-- === 메인 콘텐츠 (기능 연결을 위한 최종 수정) === -->
<!-- ================================================== -->
<main class="main-content">
    <h1 class="h3 mb-4 font-weight-bold" style="color: #5a5c69;">역할별 권한 관리</h1>
    
    <div class="row">
        <!-- 1. 왼쪽: 역할 목록 -->
        <div class="col-lg-4">
            <div class="card role-list">
                <div class="card-header font-weight-bold">역할 목록</div>
                <!-- ★ 역할 목록에 id="roleList" 추가 -->
                <div class="list-group list-group-flush" id="roleList">
                    <!-- ▼▼▼ 각 역할 링크에 data-role-id와 data-role-name 추가 ▼▼▼ -->
                    <a href="#" class="list-group-item list-group-item-action active" data-role-id="2" data-role-name="시스템 운영 관리자">
                        <i class="fas fa-cogs mr-2"></i> 시스템 운영 관리자
                    </a>
                    <a href="#" class="list-group-item list-group-item-action" data-role-id="3" data-role-name="사용자 관리 담당">
                        <i class="fas fa-user-cog mr-2"></i> 사용자 관리 담당
                    </a>
                    <a href="#" class="list-group-item list-group-item-action" data-role-id="4" data-role-name="게시판 관리 담당">
                        <i class="fas fa-clipboard-list mr-2"></i> 게시판 관리 담당
                    </a>
                    <a href="#" class="list-group-item list-group-item-action" data-role-id="5" data-role-name="고객 지원 담당자">
                        <i class="fas fa-headset mr-2"></i> 고객 지원 담당자
                    </a>
                    <a href="#" class="list-group-item list-group-item-action" data-role-id="6" data-role-name="상품 승인/반려 담당">
                        <i class="fas fa-tasks mr-2"></i> 상품 승인/반려 담당
                    </a>
                    <a href="#" class="list-group-item list-group-item-action" data-role-id="7" data-role-name="스토어 입점/계약 담당">
                        <i class="fas fa-store mr-2"></i> 스토어 입점/계약 담당
                    </a>
                    <a href="#" class="list-group-item list-group-item-action" data-role-id="8" data-role-name="판매자">
                        <i class="fas fa-user-tag mr-2"></i> 판매자
                    </a>
                    <a href="#" class="list-group-item list-group-item-action" data-role-id="9" data-role-name="일반 사용자">
                        <i class="fas fa-user mr-2"></i> 일반 사용자
                    </a>
                    <a href="#" class="list-group-item list-group-item-action" data-role-id="10" data-role-name="비회원">
                        <i class="fas fa-user-slash mr-2"></i> 비회원
                    </a>
                </div>
            </div>
        </div>

        <!-- 2. 오른쪽: 선택된 역할의 권한 상세 (데이터 채움) -->
        <div class="col-lg-8">
            <div class="card permission-card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <span class="font-weight-bold text-primary" id="permissionTitle">
				        <i class="fas fa-cogs mr-2"></i> 시스템 운영 관리자의 권한
				    </span>
                    <div>
                        <button class="btn btn-sm btn-outline-secondary" id="selectAllBtn">전체 선택</button>
                        <button class="btn btn-sm btn-outline-secondary ml-1" id="deselectAllBtn">전체 해제</button>
                    </div>
                </div>

                <!-- ▼▼▼▼▼ card-body 부분을 아래 코드로 교체 ▼▼▼▼▼ -->
                <div class="card-body" style="max-height: 520px; overflow-y: auto;" id="permissionCheckboxes">
                    
                    <!-- '시스템 운영 관리자'(role_id=2)는 권한 (1, 2, 3, 4, 5, 6, 7, 8, 9, 12, 17, 18, 23, 24, 29, 34, 35, 36)를 가집니다. -->
                    
                    <div class="mb-3">
                        <h6 class="font-weight-bold border-bottom pb-2 mb-3"><i class="fas fa-user-friends mr-2"></i> 사용자/회원</h6>
                        <div class="custom-control custom-checkbox">
                        	<input type="checkbox" class="custom-control-input" id="perm-1" checked>
                        	<label class="custom-control-label" for="perm-1">모든 사용자 계정 관리 (1)</label>
                        </div>
                        <div class="custom-control custom-checkbox">
	                        <input type="checkbox" class="custom-control-input" id="perm-2" checked>
	                        <label class="custom-control-label" for="perm-2">자신의 프로필 관리 (2)</label>
                        </div>
                        <div class="custom-control custom-checkbox">
	                        <input type="checkbox" class="custom-control-input" id="perm-3" checked>
	                        <label class="custom-control-label" for="perm-3">자신의 보안 설정 관리 (3)</label>
                        </div>
                        <div class="custom-control custom-checkbox">
	                        <input type="checkbox" class="custom-control-input" id="perm-24" checked>
	                        <label class="custom-control-label" for="perm-24">모든 사용자 구독 정보 조회 (24)</label>
                        </div>
                        <div class="custom-control custom-checkbox">
	                        <input type="checkbox" class="custom-control-input" id="perm-38">
	                        <label class="custom-control-label" for="perm-38">계좌 권한 (38)</label>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <h6 class="font-weight-bold border-bottom pb-2 mb-3"><i class="fas fa-box-open mr-2"></i> 상품/주문</h6>
                        <div class="custom-control custom-checkbox">
	                        <input type="checkbox" class="custom-control-input" id="perm-11">
	                        <label class="custom-control-label" for="perm-11">자신의 상점 상품 관리 (11)</label>
                        </div>
                        <div class="custom-control custom-checkbox">
	                        <input type="checkbox" class="custom-control-input" id="perm-12" checked>
	                        <label class="custom-control-label" for="perm-12">모든 공개 상품 정보 조회 (12)</label>
                        </div>
                        <div class="custom-control custom-checkbox">
	                        <input type="checkbox" class="custom-control-input" id="perm-13">
	                        <label class="custom-control-label" for="perm-13">일반 상품 구매 (13)</label>
                        </div>
                        <div class="custom-control custom-checkbox">
	                        <input type="checkbox" class="custom-control-input" id="perm-14">
	                        <label class="custom-control-label" for="perm-14">자신의 주문 내역 조회 (14)</label>
                        </div>
                        <div class="custom-control custom-checkbox">
	                        <input type="checkbox" class="custom-control-input" id="perm-15">
	                        <label class="custom-control-label" for="perm-15">자신의 상점 주문 내역 조회 (15)</label>
                        </div>
                        <div class="custom-control custom-checkbox">
	                        <input type="checkbox" class="custom-control-input" id="perm-25">
	                        <label class="custom-control-label" for="perm-25">상품 승인/반려 (25)</label>
                        </div>
                    </div>

                    <div class="mb-3">
                        <h6 class="font-weight-bold border-bottom pb-2 mb-3"><i class="fas fa-comments mr-2"></i> 게시판/피드/댓글</h6>
                        <div class="custom-control custom-checkbox">
	                        <input type="checkbox" class="custom-control-input" id="perm-4" checked>
	                        <label class="custom-control-label" for="perm-4">일반 게시글 작성 (4)</label>
                        </div>
                        <div class="custom-control custom-checkbox">
	                        <input type="checkbox" class="custom-control-input" id="perm-5" checked>
	                        <label class="custom-control-label" for="perm-5">모든 공개 게시글 조회 (5)</label>
                        </div>
                        <div class="custom-control custom-checkbox">
	                        <input type="checkbox" class="custom-control-input" id="perm-6" checked>
	                        <label class="custom-control-label" for="perm-6">자신의 게시글 관리 (6)</label>
                        </div>
                        <div class="custom-control custom-checkbox">
	                        <input type="checkbox" class="custom-control-input" id="perm-7" checked>
	                        <label class="custom-control-label" for="perm-7">모든 일반 게시글 관리 (7)</label>
                        </div>
                        <div class="custom-control custom-checkbox">
	                        <input type="checkbox" class="custom-control-input" id="perm-8" checked>
	                        <label class="custom-control-label" for="perm-8">댓글 작성 (8)</label>
                        </div>
                        <div class="custom-control custom-checkbox">
	                        <input type="checkbox" class="custom-control-input" id="perm-9" checked>
	                        <label class="custom-control-label" for="perm-9">자신의 댓글 관리 (9)</label>
                        </div>
                        <div class="custom-control custom-checkbox">
	                        <input type="checkbox" class="custom-control-input" id="perm-10">
	                        <label class="custom-control-label" for="perm-10">모든 일반 댓글 관리 (10)</label>
                        </div>
                        <div class="custom-control custom-checkbox">
	                        <input type="checkbox" class="custom-control-input" id="perm-16">
	                        <label class="custom-control-label" for="perm-16">자신의 피드 관리 (16)</label>
                        </div>
                        <div class="custom-control custom-checkbox">
	                        <input type="checkbox" class="custom-control-input" id="perm-17" checked>
	                        <label class="custom-control-label" for="perm-17">모든 사용자 피드 관리 (17)</label>
                        </div>
                        <div class="custom-control custom-checkbox">
	                        <input type="checkbox" class="custom-control-input" id="perm-18" checked>
	                        <label class="custom-control-label" for="perm-18">모든 공개 피드 조회 (18)</label>
                        </div>
                        <div class="custom-control custom-checkbox">
	                        <input type="checkbox" class="custom-control-input" id="perm-19">
	                        <label class="custom-control-label" for="perm-19">피드에 반응 남기기 (19)</label>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <h6 class="font-weight-bold border-bottom pb-2 mb-3"><i class="fas fa-headset mr-2"></i> 운영/지원</h6>
                        <div class="custom-control custom-checkbox">
	                        <input type="checkbox" class="custom-control-input" id="perm-27">
	                        <label class="custom-control-label" for="perm-27">판매자 입점 신청/계약 처리 (27)</label>
                        </div>
                        <div class="custom-control custom-checkbox">
	                        <input type="checkbox" class="custom-control-input" id="perm-28">
	                        <label class="custom-control-label" for="perm-28">고객 문의 응대 및 처리 (28)</label>
                        </div>
                        <div class="custom-control custom-checkbox">
	                        <input type="checkbox" class="custom-control-input" id="perm-29" checked>
	                        <label class="custom-control-label" for="perm-29">모든 신고 접수 및 처리 (29)</label>
                        </div>
                        <div class="custom-control custom-checkbox">
	                        <input type="checkbox" class="custom-control-input" id="perm-36" checked>
	                        <label class="custom-control-label" for="perm-36">시스템 전체/그룹 알림 발송 (36)</label>
                        </div>
                        <div class="custom-control custom-checkbox">
	                        <input type="checkbox" class="custom-control-input" id="perm-37">
	                        <label class="custom-control-label" for="perm-37">자신의 상점 대상 알림 발송 (37)</label>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <h6 class="font-weight-bold border-bottom pb-2 mb-3"><i class="fas fa-puzzle-piece mr-2"></i> 기타</h6>
                        <div class="custom-control custom-checkbox">
	                        <input type="checkbox" class="custom-control-input" id="perm-20">
	                        <label class="custom-control-label" for="perm-20">투표 생성 (20)</label>
                        </div>
                        <div class="custom-control custom-checkbox">
	                        <input type="checkbox" class="custom-control-input" id="perm-26">
	                        <label class="custom-control-label" for="perm-26">투표 참여 (26)</label>
                        </div>
                        <div class="custom-control custom-checkbox">
	                        <input type="checkbox" class="custom-control-input" id="perm-21">
	                        <label class="custom-control-label" for="perm-21">자신의 상점 설정 변경 (21)</label>
                        </div>
                        <div class="custom-control custom-checkbox">
	                        <input type="checkbox" class="custom-control-input" id="perm-22">
	                        <label class="custom-control-label" for="perm-22">자신의 정산 내역 조회 (22)</label>
                        </div>
                        <div class="custom-control custom-checkbox">
	                        <input type="checkbox" class="custom-control-input" id="perm-35" checked>
	                        <label class="custom-control-label" for="perm-35">플랫폼 전체 쿠폰 관리 (35)</label>
                        </div>
                        <div class="custom-control custom-checkbox">
	                        <input type="checkbox" class="custom-control-input" id="perm-39">
	                        <label class="custom-control-label" for="perm-39">쿠폰 발급 (39)</label>
                        </div>
                    </div>

                    <!-- 총관리자 전용 권한은 여기에 표시하지 않거나, 비활성화 처리할 수 있습니다. -->
                    <div class="mb-3">
                         <h6 class="font-weight-bold border-bottom pb-2 mb-3"><i class="fas fa-lock mr-2"></i> 시스템/관리자 설정 (총관리자 전용)</h6>
                         <div class="custom-control custom-checkbox">
	                         <input type="checkbox" class="custom-control-input" id="perm-30" disabled>
	                         <label class="custom-control-label" for="perm-30">시스템 전체 설정 관리 (30)</label>
                         </div>
                         <div class="custom-control custom-checkbox">
	                         <input type="checkbox" class="custom-control-input" id="perm-31" disabled>
	                         <label class="custom-control-label" for="perm-31">모든 역할 생성/수정/삭제 (31)</label>
                         </div>
                         <div class="custom-control custom-checkbox">
	                         <input type="checkbox" class="custom-control-input" id="perm-32" disabled>
	                         <label class="custom-control-label" for="perm-32">모든 역할에 권한 할당/해제 (32)</label>
                         </div>
                         <div class="custom-control custom-checkbox">
	                         <input type="checkbox" class="custom-control-input" id="perm-33" disabled>
	                         <label class="custom-control-label" for="perm-33">모든 사용자에게 역할 할당/해제 (33)</label>
                         </div>
                         <div class="custom-control custom-checkbox">
	                         <input type="checkbox" class="custom-control-input" id="perm-34" checked>
	                         <label class="custom-control-label" for="perm-34">모든 게시판 생성/설정/삭제 (34)</label>
                         </div>
                         <div class="custom-control custom-checkbox">
	                         <input type="checkbox" class="custom-control-input" id="perm-23" checked>
	                         <label class="custom-control-label" for="perm-23">구독 플랜 관리 (23)</label>
                         </div>
                    </div>
                </div>
                
                <div class="card-footer text-right bg-white">
                    <button class="btn btn-primary"><i class="fas fa-save mr-2"></i> 저장</button>
                    <button class="btn btn-secondary">취소</button>
                </div>
            </div>
        </div>
    </div>
</main>
   
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<!-- ▼▼▼▼▼ 여기에 새로운 기능 스크립트 추가 ▼▼▼▼▼ -->
<script>
$(document).ready(function() {

    // --- 데이터 (DB에서 받아온 역할-권한 매핑 정보) ---
    // 나중에는 이 데이터를 서버 API를 통해 동적으로 받아옵니다.
    const permissionsData = {
        // key: role_id, value: array of permission_ids
        "2": [1, 2, 3, 5, 7, 10, 12, 17, 18, 23, 24, 29, 34, 35, 36],
        "3": [1, 2, 5, 17, 18, 29, 39],
        "4": [2, 5, 6, 7, 8, 9, 10, 17, 18, 19, 20, 26],
        "5": [2, 5, 12, 14, 17, 18, 28],
        "6": [2, 12, 25],
        "7": [1, 2, 27, 28],
        "8": [2, 3, 4, 5, 6, 8, 9, 11, 12, 14, 15, ,16, 18, 19, 20, 21, 22, 26, 35, 37],
        "9": [2, 3, 4, 5, 6, 8, 9, 12, 13, 14, 16, 18, 19, 20, 26],
        "10": [5, 12, 8],
    };

    // --- 함수 정의 ---
    
    // 선택된 역할에 따라 오른쪽 권한 체크박스를 업데이트하는 함수
    function updatePermissionView(roleId, roleName) {
        // 1. 제목 변경
        const titleIcon = $(`#roleList a[data-role-id="${roleId}"] i`).clone();
        $('#permissionTitle').html(titleIcon).append(` ${roleName}의 권한`);
        
        // 2. 모든 체크박스 초기화 (전부 해제)
        $('#permissionCheckboxes input[type="checkbox"]').prop('checked', false);

        // 3. 해당 역할이 가진 권한들만 다시 체크
        const rolePermissions = permissionsData[roleId] || [];
        rolePermissions.forEach(function(permissionId) {
            $('#perm-' + permissionId).prop('checked', true);
        });
    }

    // --- 이벤트 리스너 ---

    // 왼쪽 역할 목록을 클릭했을 때
    $('#roleList a').on('click', function(e) {
        e.preventDefault(); 

        $('#roleList a').removeClass('active');
        $(this).addClass('active');

        const selectedRoleId = $(this).data('role-id');
        const selectedRoleName = $(this).data('role-name');
        
        updatePermissionView(selectedRoleId, selectedRoleName);
    });

    // '전체 선택' 버튼 클릭
    $('#selectAllBtn').on('click', function() {
        // 비활성화된 총관리자 전용 권한은 선택되지 않도록 필터링
        $('#permissionCheckboxes input[type="checkbox"]:not(:disabled)').prop('checked', true);
    });

    // '전체 해제' 버튼 클릭
    $('#deselectAllBtn').on('click', function() {
        $('#permissionCheckboxes input[type="checkbox"]:not(:disabled)').prop('checked', false);
    });

    // '저장' 버튼 클릭
    $('#saveBtn').on('click', function() {
        const selectedRoleId = $('#roleList .active').data('role-id');
        const selectedRoleName = $('#roleList .active').data('role-name');
        const checkedPermissions = [];
        
        $('#permissionCheckboxes input[type="checkbox"]:checked').each(function() {
            // 'perm-1'에서 숫자 1만 추출
            const permissionId = $(this).attr('id').split('-')[1];
            checkedPermissions.push(permissionId);
        });

        const resultMessage = 
            `선택된 역할: ${selectedRoleName} (ID: ${selectedRoleId})\n` +
            `부여된 권한 ID: ${checkedPermissions.join(', ')}\n\n` +
            `이 데이터를 서버로 전송하여 DB에 업데이트(DELETE 후 INSERT)합니다.`;
            
        alert(resultMessage);
    });

    // 페이지 로드 시, 기본 선택된 역할의 권한을 표시
    const initialRoleId = $('#roleList .active').data('role-id');
    const initialRoleName = $('#roleList .active').data('role-name');
    if (initialRoleId) {
        updatePermissionView(initialRoleId, initialRoleName);
    }
});
</script>
</body>
	 </th:block>	
</html>