<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ks55team02.seller.products.mapper.ProductCategoryMapper">

	<!-- ProductsMapper에 있던 더 완전한 버전의 ResultMap으로 교체 -->
	<resultMap id="productCategoryResultMap" type="ks55team02.seller.products.domain.ProductCategory">
		<id property="categoryId" column="ctgry_no" />
		<result property="parentCategoryId" column="up_ctgry_no" />
		<result property="userNo" column="creatr_no" />
		<result property="categoryName" column="ctgry_nm" />
		<result property="categoryLevel" column="ctgry_dpth" />
		<result property="regDate" column="reg_dt" />
		<result property="activationYn" column="actvtn_yn" />
	</resultMap>

	<!-- 카테고리 ID로 단일 카테고리 정보 조회 (from ProductsMapper) -->
	<select id="getCategoryById" parameterType="String" resultMap="productCategoryResultMap">
		SELECT
		ctgry_no, up_ctgry_no, creatr_no, ctgry_nm, ctgry_dpth, reg_dt, actvtn_yn
		FROM ks55team02db.product_categories
		WHERE ctgry_no = #{categoryId} AND actvtn_yn = TRUE;
	</select>

	<!-- 부모 카테고리 ID에 해당하는 하위 카테고리 목록 조회 -->
    <!-- (id를 getSubCategoriesByParentId로 변경, 파라미터를 parentCategoryId로 변경) -->
	<select id="getSubCategoriesByParentId" parameterType="String" resultMap="productCategoryResultMap">
		SELECT
		ctgry_no, up_ctgry_no, creatr_no, ctgry_nm, ctgry_dpth, reg_dt, actvtn_yn
		FROM ks55team02db.product_categories
		WHERE up_ctgry_no = #{parentCategoryId} AND actvtn_yn = TRUE
		ORDER BY ctgry_nm;
	</select>

	<!-- 모든 최상위 카테고리 목록 조회 (from ProductsMapper) -->
	<select id="getAllTopLevelCategories" resultMap="productCategoryResultMap">
		SELECT
		ctgry_no, up_ctgry_no, creatr_no, ctgry_nm, ctgry_dpth, reg_dt, actvtn_yn
		FROM ks55team02db.product_categories
		WHERE up_ctgry_no IS NULL AND actvtn_yn = TRUE
		ORDER BY ctgry_nm;
	</select>

	<!-- 최상위 카테고리 이름으로 카테고리 ID 조회 (from ProductsMapper) -->
	<select id="getTopLevelCategoryIdByName" parameterType="String" resultType="String">
		SELECT ctgry_no
		FROM ks55team02db.product_categories
		WHERE ctgry_nm = #{categoryName} AND up_ctgry_no IS NULL AND actvtn_yn = TRUE
		LIMIT 1;
	</select>

	<!-- 모든 상품 카테고리 목록 조회 -->
	<select id="getAllProductCategories" resultMap="productCategoryResultMap">
		SELECT
		ctgry_no, up_ctgry_no, creatr_no, ctgry_nm, ctgry_dpth, reg_dt, actvtn_yn
		FROM ks55team02db.product_categories
		WHERE actvtn_yn = TRUE
		ORDER BY ctgry_nm;
	</select>

</mapper>